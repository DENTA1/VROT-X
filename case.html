<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–µ–π—Å—ã</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: white;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #16213e;
            border-bottom: 2px solid #0f3460;
        }
        
        .back-button {
            padding: 8px 15px;
            background-color: #0f3460;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .title {
            font-size: 24px;
            color: #4cc9f0;
        }
        
        .balance {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 18px;
            color: #4cc9f0;
        }
        
        .cases-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .case {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #0f3460;
            text-align: center;
        }
        
        .case-name {
            font-size: 20px;
            margin-bottom: 10px;
            color: #4cc9f0;
        }
        
        .case-price {
            color: #e94560;
            margin: 10px 0;
        }
        
        .open-button {
            background: #e94560;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.3s;
        }
        
        .open-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .animation-box {
            width: 300px;
            height: 400px;
            position: relative;
            overflow: hidden;
            border: 2px solid #4cc9f0;
            border-radius: 10px;
        }
        
        .prize-container {
            position: absolute;
            width: 100%;
            transition: transform 2s ease-out;
        }
        
        .prize-item {
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            border-bottom: 1px solid #4cc9f033;
        }
        
        .result-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            border: 2px solid #4cc9f0;
        }
        
        .result-amount {
            font-size: 32px;
            color: #4cc9f0;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-button">–ù–∞–∑–∞–¥</button>
        <div class="title">–ö–µ–π—Å—ã</div>
        <div class="balance">
            <span>üí∞</span>
            <span id="balance">0</span>
        </div>
    </div>

    <div class="cases-container">
        <div class="case">
            <div class="case-name">–ü—Ä–æ—Å—Ç–æ–π –∫–µ–π—Å</div>
            <div class="case-price">–°—Ç–æ–∏–º–æ—Å—Ç—å: 10—Ä</div>
            <button class="open-button" onclick="openCase(10)">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div class="animation-container" id="animationContainer">
        <div class="animation-box">
            <div class="prize-container" id="prizeContainer"></div>
        </div>
    </div>

    <div class="result-modal" id="resultModal">
        <div class="result-amount" id="resultAmount"></div>
        <button class="open-button" onclick="closeResult()">OK</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCMos6Y7C-krTLuKCI4VJG-TFLo6QI--k8",
            authDomain: "vrot-x-7a48f.firebaseapp.com",
            databaseURL: "https://vrot-x-7a48f-default-rtdb.firebaseio.com",
            projectId: "vrot-x-7a48f",
            storageBucket: "vrot-x-7a48f.firebasestorage.app",
            messagingSenderId: "622297225288",
            appId: "1:622297225288:web:5df6a5b02ffddedd96e07d"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let userId = null;
        let userBalance = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function initUser() {
            userId = getCookie('tg_user_id');
            if (!userId) return alert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!');
            
            database.ref('users/' + userId + '/balance').on('value', snapshot => {
                userBalance = snapshot.val() || 0;
                document.getElementById('balance').textContent = userBalance;
                updateButtons();
            });
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function updateButtons() {
            document.querySelectorAll('.open-button').forEach(btn => {
                btn.disabled = userBalance < parseInt(btn.getAttribute('data-price'));
            });
        }

        function openCase(price) {
            if (userBalance < price) return;
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞
            database.ref('users/' + userId).update({
                balance: userBalance - price
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–∑
            const prizes = [
                {amount: 10, chance: 40},
                {amount: 20, chance: 30},
                {amount: 50, chance: 20},
                {amount: 100, chance: 10}
            ];
            
            const totalChance = prizes.reduce((sum, p) => sum + p.chance, 0);
            const random = Math.random() * totalChance;
            let current = 0;
            let selectedPrize = null;
            
            for (const prize of prizes) {
                current += prize.chance;
                if (random <= current) {
                    selectedPrize = prize;
                    break;
                }
            }

            startAnimation(selectedPrize);
        }

        function startAnimation(prize) {
            const container = document.getElementById('prizeContainer');
            container.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            for (let i = 0; i < 20; i++) {
                const div = document.createElement('div');
                div.className = 'prize-item';
                div.textContent = prizes[i % prizes.length].amount + '—Ä';
                container.appendChild(div);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            const animationContainer = document.getElementById('animationContainer');
            animationContainer.style.display = 'flex';
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
            const targetPosition = - (prize.amount * 80) + 200; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞
            
            container.style.transform = `translateY(${targetPosition}px)`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                animationContainer.style.display = 'none';
                showResult(prize.amount);
            }, 2000);
        }

        function showResult(amount) {
            // –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
            database.ref('users/' + userId).update({
                balance: userBalance + amount
            });

            document.getElementById('resultAmount').textContent = `${amount}—Ä`;
            document.getElementById('resultModal').style.display = 'block';
        }

        function closeResult() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = initUser;
    </script>
</body>
</html>
