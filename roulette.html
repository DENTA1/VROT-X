<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plinko Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        .game-container {
            position: relative;
            width: 600px;
            height: 500px;
            background-color: #222;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .peg {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #777;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .ball {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #f00;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        .bucket {
            position: absolute;
            bottom: 0;
            height: 30px;
            border-top: 15px solid #444;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .controls {
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            height: 24px;
        }
    </style>
</head>
<body>
    <h1>Plinko Game</h1>
    <div class="game-container" id="gameContainer"></div>
    <div class="controls">
        <button id="dropBall">Запустить шарик</button>
    </div>
    <div class="result" id="result"></div>

    <script>
        const gameContainer = document.getElementById('gameContainer');
        const dropBallBtn = document.getElementById('dropBall');
        const resultDisplay = document.getElementById('result');
        
        const containerWidth = gameContainer.offsetWidth;
        const containerHeight = gameContainer.offsetHeight;
        
        // Коэффициенты для ячеек
        const multipliers = [5, 2, 1.5, 1, 0.5, 1, 1.5, 2, 5];
        const bucketCount = multipliers.length;
        const bucketWidth = containerWidth / bucketCount;
        
        // Создание ячеек
        for (let i = 0; i < bucketCount; i++) {
            const bucket = document.createElement('div');
            bucket.className = 'bucket';
            bucket.style.width = `${bucketWidth}px`;
            bucket.style.left = `${i * bucketWidth}px`;
            bucket.textContent = `x${multipliers[i]}`;
            gameContainer.appendChild(bucket);
        }
        
        // Создание препятствий (точек)
        const pegRows = 12;
        const pegCols = 15;
        const pegHorizontalSpacing = containerWidth / (pegCols + 1);
        const pegVerticalSpacing = (containerHeight - 100) / pegRows;
        
        for (let row = 0; row < pegRows; row++) {
            // Смещение четных рядов для создания шахматного порядка
            const offset = row % 2 === 0 ? pegHorizontalSpacing / 2 : 0;
            
            for (let col = 0; col < (row % 2 === 0 ? pegCols : pegCols + 1); col++) {
                const peg = document.createElement('div');
                peg.className = 'peg';
                peg.style.left = `${offset + col * pegHorizontalSpacing}px`;
                peg.style.top = `${50 + row * pegVerticalSpacing}px`;
                gameContainer.appendChild(peg);
            }
        }
        
        // Массив активных шариков
        const balls = [];
        
        // Физические параметры
        const gravity = 0.2;
        const friction = 0.99;
        const bounce = 0.8;
        const pegRadius = 5;
        const ballRadius = 10;
        
        // Функция создания нового шарика
        function createBall() {
            const ball = document.createElement('div');
            ball.className = 'ball';
            
            // Случайная начальная позиция в верхней части
            const x = Math.random() * (containerWidth - 40) + 20;
            ball.style.left = `${x}px`;
            ball.style.top = '20px';
            
            gameContainer.appendChild(ball);
            
            // Начальная скорость
            const velocity = {
                x: (Math.random() - 0.5) * 2,
                y: 0
            };
            
            // Состояние шарика
            const state = {
                element: ball,
                x: x,
                y: 20,
                vx: velocity.x,
                vy: velocity.y,
                active: true
            };
            
            balls.push(state);
            return state;
        }
        
        // Проверка столкновения с препятствиями
        function checkPegCollision(ball) {
            const pegs = document.querySelectorAll('.peg');
            
            pegs.forEach(peg => {
                const pegX = parseFloat(peg.style.left);
                const pegY = parseFloat(peg.style.top);
                
                // Расстояние между шариком и препятствием
                const dx = ball.x - pegX;
                const dy = ball.y - pegY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // Если есть столкновение
                if (distance < ballRadius + pegRadius) {
                    // Нормализованный вектор
                    const nx = dx / distance;
                    const ny = dy / distance;
                    
                    // Скорость вдоль нормали
                    const dotProduct = ball.vx * nx + ball.vy * ny;
                    
                    // Изменение скорости при столкновении
                    ball.vx -= 2 * dotProduct * nx * bounce;
                    ball.vy -= 2 * dotProduct * ny * bounce;
                    
                    // Отодвигаем шарик, чтобы он не застрял
                    const overlap = ballRadius + pegRadius - distance;
                    ball.x += nx * overlap * 0.5;
                    ball.y += ny * overlap * 0.5;
                }
            });
        }
        
        // Проверка попадания в ячейку
        function checkBucketCollision(ball) {
            if (ball.y > containerHeight - 30 && ball.vy > 0) {
                const bucketIndex = Math.floor(ball.x / bucketWidth);
                
                if (bucketIndex >= 0 && bucketIndex < bucketCount) {
                    resultDisplay.textContent = `Вы выиграли: x${multipliers[bucketIndex]}`;
                    return true;
                }
            }
            return false;
        }
        
        // Основной цикл игры
        function gameLoop() {
            for (let i = balls.length - 1; i >= 0; i--) {
                const ball = balls[i];
                
                if (!ball.active) continue;
                
                // Применяем гравитацию
                ball.vy += gravity;
                
                // Применяем трение
                ball.vx *= friction;
                ball.vy *= friction;
                
                // Обновляем позицию
                ball.x += ball.vx;
                ball.y += ball.vy;
                
                // Проверяем столкновения с границами
                if (ball.x < ballRadius) {
                    ball.x = ballRadius;
                    ball.vx = -ball.vx * bounce;
                } else if (ball.x > containerWidth - ballRadius) {
                    ball.x = containerWidth - ballRadius;
                    ball.vx = -ball.vx * bounce;
                }
                
                // Проверяем столкновения с препятствиями
                checkPegCollision(ball);
                
                // Обновляем позицию на экране
                ball.element.style.left = `${ball.x}px`;
                ball.element.style.top = `${ball.y}px`;
                
                // Проверяем попадание в ячейку
                if (checkBucketCollision(ball)) {
                    ball.active = false;
                    setTimeout(() => {
                        gameContainer.removeChild(ball.element);
                        balls.splice(i, 1);
                    }, 100);
                }
                
                // Удаляем шарики, которые вылетели за нижнюю границу
                if (ball.y > containerHeight + 50) {
                    gameContainer.removeChild(ball.element);
                    balls.splice(i, 1);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Запуск игры
        dropBallBtn.addEventListener('click', createBall);
        gameLoop();
    </script>
</body>
</html>
